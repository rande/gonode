version: '2'
services:
    back:
        image: ekino/docker-buildbox:golang1.7-2017.02.07
        command: modd
        ports:
            - "127.0.0.1:2508:2508"
        volumes:
            - ".:/go/src/github.com/rande/gonode"
            - "gopath:/go"
            - "tmp:/tmp/gnode"
        working_dir: /go/src/github.com/rande/gonode
        links:
            - influxdb
            - database
        environment:
            POSTGRES_PASSWORD: gonode
            POSTGRES_DB: gonode
            INFLUXDB_HOST: influxdb
            PATH: /go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

    front:
        image: ekino/docker-buildbox:node9.11-2018.05.18
        command: ng build --watch --delete-output-path=false --deploy-url /explorer/ --base-href /explorer
        volumes:
            - "./gui:/code:cached"
        working_dir: /code
        environment:
            PATH: /code/node_modules/.bin:/root/.nvm/versions/node/current/bin:usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

    influxdb:
        image: influxdb
        volumes:
            - "influxdb:/var/lib/influxdb/data"

    database:
        image: postgres:9.5
        volumes:
            - "postgresql:/var/lib/postgresql/data"
        ports:
            - "127.0.0.1:5432:5432"
        environment:
            POSTGRES_PASSWORD: gonode
            POSTGRES_DB: gonode

volumes:
    gopath:
    postgresql:
    influxdb:
    tmp:
